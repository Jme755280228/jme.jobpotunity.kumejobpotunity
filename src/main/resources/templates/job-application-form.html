<!DOCTYPE html>
<html lang="my" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="|${job.title} အတွက် လျှောက်လွှာ|"></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .application-form-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2.5rem;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .field-section {
            border-top: 2px solid #e5e7eb;
            padding-top: 1.5rem;
            margin-top: 2rem;
        }
        .required-tag {
            font-size: 0.75rem;
            background-color: #fca5a5;
            color: #b91c1c;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    
    <!-- Header Fragment Placeholder -->
    <div th:replace="~{fragments/header :: main-header}"></div>

    <div class="container mx-auto p-4">
        <div class="application-form-container">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2" th:text="${job.title}">Job Title</h1>
            <p class="text-lg text-indigo-600 mb-6" th:text="${job.company != null ? job.company.name : 'Company Name'}">Company Name</p>
            
            <form th:action="@{/applicant/apply/{jobId}(jobId=${job.id})}" method="post" enctype="multipart/form-data">
                
                <!-- 1. Basic Profile Summary -->
                <div class="bg-indigo-50 p-4 rounded-lg mb-6">
                    <h3 class="text-xl font-semibold text-indigo-700 mb-3">သင်၏ ပရိုဖိုင်</h3>
                    <p class="text-sm text-gray-700">ဤအလုပ်လျှောက်လွှာသည် သင်၏ **Structured Profile Data** (ကိုယ်ရေးအကျဉ်း၊ ပညာအရည်အချင်း၊ အလုပ်အတွေ့အကြုံ) ကို အသုံးပြု၍ အလိုအလျောက် ပေးပို့မည်ဖြစ်ပါသည်။</p>
                    <p class="mt-2 text-sm">
                        အမည်: <span th:text="${profile.fullName}" class="font-medium"></span> | 
                        အီးမေးလ်: <span th:text="${profile.email}" class="font-medium"></span>
                        <a th:href="@{/profile/edit}" class="text-blue-500 hover:text-blue-700 ml-4 font-medium">(ပရိုဖိုင် ပြင်ဆင်ရန်)</a>
                    </p>
                </div>
                
                <!-- 2. Custom Required Fields Section -->
                <div th:if="${not #lists.isEmpty(customResponses)}" class="field-section">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">အပိုဖြည့်စွက်ရန် လိုအပ်သော အချက်အလက်များ</h3>
                    
                    <div th:each="response, iterStat : ${customResponses}" class="mb-6">
                        <div th:with="field=${response.applicationField}">
                            
                            <label th:for="|response_${field.id}|" class="block text-base font-medium text-gray-700 mb-2">
                                <span th:text="${field.fieldName}">Field Name</span> 
                                <span th:if="${field.isRequired}" class="required-tag">လိုအပ်သည်</span>
                            </label>

                            <!-- Dynamic Input Type based on field.fieldType (Simplified to TEXTAREA for demonstration) -->
                            <th:block th:switch="${field.fieldType}">
                                <!-- Long Text fields should use textarea -->
                                <textarea th:case="'LONG_TEXT'" 
                                          th:id="|response_${field.id}|" 
                                          th:name="|response_${field.id}|" 
                                          rows="4" 
                                          th:placeholder="|${field.description}|"
                                          class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" 
                                          th:required="${field.isRequired}">
                                </textarea>
                                
                                <!-- Default to Text Input (for SHORT_TEXT, NUMBER, DATE etc.) -->
                                <input th:case="*" 
                                       type="text" 
                                       th:id="|response_${field.id}|" 
                                       th:name="|response_${field.id}|" 
                                       th:placeholder="|${field.description}|"
                                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" 
                                       th:required="${field.isRequired}">
                                
                                <!-- NOTE: FILE, CHECKBOX, RADIO types would require more complex implementation -->
                            </th:block>

                            <p class="text-sm text-gray-500 mt-1" th:text="${field.description}"></p>
                        </div>
                    </div>
                </div>
                
                <div th:unless="${not #lists.isEmpty(customResponses)}" class="field-section bg-green-50 p-4 rounded-lg">
                    <p class="text-gray-700 font-medium">ဤအလုပ်အတွက် အပိုဖြည့်စွက်ရန် Custom Field များမရှိပါ။</p>
                </div>

                <!-- 3. CV Required Option -->
                <div th:if="${isCvRequired}" class="field-section">
                    <h3 class="text-xl font-bold text-gray-800 mb-3">CV / Resume File</h3>
                    <p class="text-sm text-gray-600 mb-3">ဤအလုပ်သည် CV/Resume File တင်ရန် လိုအပ်ပါသည်။</p>
                    <!-- NOTE: CV Upload functionality requires a dedicated File Storage Service and is not implemented here -->
                    <div class="p-3 bg-red-100 border border-red-300 rounded-md text-red-800">
                        <p class="font-semibold">⚠️ File Upload သတိပြုရန်</p>
                        <p class="text-sm">File Upload လုပ်ငန်းစဉ်ကို မထည့်သွင်းရသေးပါ။ လက်တွေ့ Project တွင် Cloud Storage (e.g. S3, GCS) ကို အသုံးပြုရမည်။</p>
                    </div>
                </div>

                <!-- Submission Button -->
                <div class="mt-8">
                    <button type="submit" class="w-full py-3 px-4 border border-transparent rounded-md shadow-lg text-lg font-semibold text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150">
                        <i class="fas fa-paper-plane mr-2"></i> လျှောက်လွှာ တင်သွင်းမည်
                    </button>
                    <a th:href="@{/job/view/{jobId}(jobId=${job.id})}" class="block text-center mt-3 text-sm text-gray-600 hover:text-indigo-600">နောက်သို့ ပြန်သွားမည်</a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Footer Fragment Placeholder -->
    <div th:replace="~{fragments/footer :: main-footer}"></div>
</body>
</html>



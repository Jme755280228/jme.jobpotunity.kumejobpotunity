<!DOCTYPE html>
<html lang="my"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á€¡á€¯á€•á€ºá€á€»á€¯á€•á€ºá€á€° Dashboard - á€¡á€œá€¯á€•á€ºá€™á€»á€¬á€¸ á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        /* New status classes for approval */
        .status-approved { color: #008000; font-weight: bold; } /* Green */
        .status-pending { color: #ff8c00; font-weight: bold; } /* Dark Orange */
        
        .status-active { color: green; font-weight: bold; }
        .status-inactive { color: orange; font-weight: bold; }
        .table-admin th {
            background-color: #007bff;
            color: white;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div th:replace="~{fragments/header :: main-header}"></div>

    <div class="container my-5">
        <h2 class="text-primary mb-4">á€¡á€œá€¯á€•á€ºá€™á€»á€¬á€¸ á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€™á€¾á€¯ (Admin View)</h2>
        <p class="lead text-muted">
            Admin: <span th:text="${adminName}" class="fw-bold text-dark"></span> á€¡á€”á€±á€–á€¼á€„á€·á€º Job á€¡á€¬á€¸á€œá€¯á€¶á€¸ (Active/Inactive) á€€á€­á€¯ á€¤á€”á€±á€›á€¬á€™á€¾ á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€ºá‹
        </p>
        
        <!-- Job Status Filter (Optional but recommended for better UX) -->
        <ul class="nav nav-tabs mb-4">
            <!-- Assuming 'jobs' list is passed from controller, which should be all jobs or filtered pending jobs -->
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Job á€¡á€¬á€¸á€œá€¯á€¶á€¸</a>
            </li>
            <!-- You might want to filter pending jobs here -->
            <li class="nav-item">
                 <!-- NOTE: This link structure assumes AdminController provides a separate view/filtered list for pending -->
                <!-- <a class="nav-link" th:href="@{/admin/jobs?status=pending}">á€¡á€á€Šá€ºá€•á€¼á€¯á€›á€”á€º á€€á€»á€”á€ºá€›á€¾á€­á€”á€±á€á€Šá€º</a> -->
            </li>
        </ul>
        
        <!-- New Job Button (Kept from original) -->
        <p class="mb-4">
            <a th:href="@{/employer/jobs/new}" class="btn btn-success btn-add-new-job shadow-sm">
                <i class="fas fa-plus me-2"></i> á€¡á€œá€¯á€•á€ºá€¡á€á€…á€ºá€á€„á€ºá€›á€”á€º
            </a>
        </p>
        
        <!-- Job Listings Table -->
        <div class="job-list-table mt-4 table-responsive">
            <!-- jobs variable (AdminController á€™á€¾ á€•á€­á€¯á€·á€œá€¬á€á€±á€¬) á€€á€­á€¯ á€…á€…á€ºá€†á€±á€¸á€•á€«á€á€Šá€º -->
            <div th:if="${jobs != null and not jobs.isEmpty()}">
                <table class="table table-striped table-hover table-bordered table-admin shadow-sm">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>á€¡á€œá€¯á€•á€ºá€¡á€™á€Šá€º (Title)</th>
                            <th>á€€á€¯á€™á€¹á€•á€á€® / á€á€„á€ºá€á€°</th>
                            <th>á€á€„á€ºá€á€Šá€·á€ºá€›á€€á€ºá€…á€½á€²</th>
                            <th>á€á€Šá€ºá€”á€±á€›á€¬</th>
                            <!-- ğŸ’¡ ADDED: Approval Status Column -->
                            <th>á€¡á€á€Šá€ºá€•á€¼á€¯á€á€»á€€á€º</th>
                            <th>Active</th>
                            <th>á€œá€¯á€•á€ºá€†á€±á€¬á€„á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loop through the jobs list -->
                        <tr th:each="job : ${jobsPage.content}">
                            <td th:text="${job.id}">1</td>
                            <td>
                                <a th:href="@{/jobs/{id}(id=${job.id})}" th:text="${job.title}">Job Title</a>
                            </td>
                            <td>
                                <span th:text="${job.employerUser?.username} ?: 'N/A'">Employer Username</span>
                            </td>
                            <td th:text="${job.postedDate}">2025-09-30</td>
                            <td th:text="${job.location}">Yangon</td>
                            
                            <!-- ğŸ’¡ ADDED: Display Approval Status -->
                            <td>
                                <span th:if="${job.isApproved()}" class="status-approved">
                                    <i class="fas fa-check-double"></i> á€¡á€á€Šá€ºá€•á€¼á€¯á€•á€¼á€®á€¸
                                </span>
                                <span th:unless="${job.isApproved()}" class="status-pending">
                                    <i class="fas fa-clock"></i> á€…á€±á€¬á€„á€·á€ºá€†á€­á€¯á€„á€ºá€¸á€†á€²
                                </span>
                            </td>
                            
                            <td>
                                <span th:if="${job.isActive()}" class="status-active">
                                    <i class="fas fa-check-circle"></i> Yes
                                </span>
                                <span th:unless="${job.isActive()}" class="status-inactive">
                                    <i class="fas fa-times-circle"></i> No
                                </span>
                            </td>
                            <td>
                                <!-- Action Buttons -->
                                <div class="btn-group" role="group">
                                    <!-- ğŸ’¡ ADDED: Approve Button (only if not approved) -->
                                    <a th:if="${!job.isApproved()}" th:href="@{/admin/jobs/approve/{id}(id=${job.id})}" class="btn btn-sm btn-success" title="á€¡á€á€Šá€ºá€•á€¼á€¯á€›á€”á€º">
                                        <i class="fas fa-thumbs-up"></i> Approve
                                    </a>
                                    
                                    <a th:href="@{/employer/jobs/edit/{id}(id=${job.id})}" class="btn btn-sm btn-warning" title="á€•á€¼á€„á€ºá€†á€„á€ºá€›á€”á€º">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a th:href="@{/employer/jobs/delete/{id}(id=${job.id})}" class="btn btn-sm btn-danger delete-btn"
                                       data-bs-toggle="modal"
                                       data-bs-target="#deleteConfirmationModal"
                                       th:data-job-id="${job.id}"
                                       title="á€–á€»á€€á€ºá€•á€…á€ºá€›á€”á€º">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                    <a th:href="@{/employer/jobs/{id}/applicants(id=${job.id})}" class="btn btn-sm btn-info" title="á€œá€»á€¾á€±á€¬á€€á€ºá€‘á€¬á€¸á€á€°á€™á€»á€¬á€¸">
                                        <i class="fas fa-users"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- No Jobs Found -->
            <div th:unless="${jobs != null and not jobs.isEmpty()}" class="alert alert-info text-center">
                <i class="fas fa-info-circle me-2"></i> á€œá€€á€ºá€›á€¾á€­á€á€½á€„á€º á€…á€®á€™á€¶á€á€”á€·á€ºá€á€½á€²á€›á€”á€º Job á€™á€»á€¬á€¸ á€…á€¬á€›á€„á€ºá€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal (Optional: For better UX) -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="deleteModalLabel">á€¡á€œá€¯á€•á€ºá€–á€»á€€á€ºá€•á€…á€ºá€á€¼á€„á€ºá€¸ á€¡á€á€Šá€ºá€•á€¼á€¯á€á€»á€€á€º</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>á€á€á€­á€•á€¼á€¯á€›á€”á€º:</strong> á€¤ Job á€€á€­á€¯ á€–á€»á€€á€ºá€œá€­á€¯á€€á€ºá€•á€«á€€ á€•á€¼á€”á€ºá€œá€Šá€ºá€–á€±á€¬á€ºá€šá€°á€”á€­á€¯á€„á€ºá€™á€Šá€ºá€™á€Ÿá€¯á€á€ºá€•á€«á‹</p>
            <p>á€†á€€á€ºá€œá€€á€ºá€†á€±á€¬á€„á€ºá€›á€½á€€á€ºá€œá€­á€¯á€•á€«á€á€œá€¬á€¸á‹</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">á€™á€–á€»á€€á€ºá€á€±á€¬á€·á€•á€«</button>
            <a id="confirmDeleteButton" href="#" class="btn btn-danger">á€¡á€á€Šá€ºá€•á€¼á€¯á€–á€»á€€á€ºá€•á€…á€ºá€™á€Šá€º</a>
          </div>
        </div>
        </div>
    </div>
    
    <div th:replace="~{fragments/footer :: main-footer}"></div>
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script>
        // JavaScript for handling the Delete Confirmation Modal
        document.addEventListener('DOMContentLoaded', function() {
            var deleteModal = document.getElementById('deleteConfirmationModal');
            if (deleteModal) {
                deleteModal.addEventListener('show.bs.modal', function (event) {
                    // Button that triggered the modal
                    var button = event.relatedTarget;
                    // Extract info from data-job-id attribute
                    var jobId = button.getAttribute('data-job-id');

                    // Update the modal's delete button link
                    var confirmButton = deleteModal.querySelector('#confirmDeleteButton');
                    confirmButton.href = '/employer/jobs/delete/' + jobId;
                });
            }
        });
    </script>
</body>
</html>



<!DOCTYPE html>
<html lang="my"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>အုပ်ချုပ်သူ Dashboard - အလုပ်များ စီမံခန့်ခွဲမှု</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        /* New status classes for approval */
        .status-approved { color: #008000; font-weight: bold; } /* Green */
        .status-pending { color: #ff8c00; font-weight: bold; } /* Dark Orange */
        
        .status-active { color: green; font-weight: bold; }
        .status-inactive { color: orange; font-weight: bold; }
        .table-admin th {
            background-color: #007bff;
            color: white;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div th:replace="~{fragments/header :: main-header}"></div>

    <div class="container my-5">
        <h2 class="text-primary mb-4">အလုပ်များ စီမံခန့်ခွဲမှု (Admin View)</h2>
        <p class="lead text-muted">
            Admin: <span th:text="${adminName}" class="fw-bold text-dark"></span> အနေဖြင့် Job အားလုံး (Active/Inactive) ကို ဤနေရာမှ စီမံခန့်ခွဲနိုင်ပါသည်။
        </p>
        
        <!-- Job Status Filter (Optional but recommended for better UX) -->
        <ul class="nav nav-tabs mb-4">
            <!-- Assuming 'jobs' list is passed from controller, which should be all jobs or filtered pending jobs -->
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Job အားလုံး</a>
            </li>
            <!-- You might want to filter pending jobs here -->
            <li class="nav-item">
                 <!-- NOTE: This link structure assumes AdminController provides a separate view/filtered list for pending -->
                <!-- <a class="nav-link" th:href="@{/admin/jobs?status=pending}">အတည်ပြုရန် ကျန်ရှိနေသည်</a> -->
            </li>
        </ul>
        
        <!-- New Job Button (Kept from original) -->
        <p class="mb-4">
            <a th:href="@{/employer/jobs/new}" class="btn btn-success btn-add-new-job shadow-sm">
                <i class="fas fa-plus me-2"></i> အလုပ်အသစ်တင်ရန်
            </a>
        </p>
        
        <!-- Job Listings Table -->
        <div class="job-list-table mt-4 table-responsive">
            <!-- jobs variable (AdminController မှ ပို့လာသော) ကို စစ်ဆေးပါသည် -->
            <div th:if="${jobs != null and not jobs.isEmpty()}">
                <table class="table table-striped table-hover table-bordered table-admin shadow-sm">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>အလုပ်အမည် (Title)</th>
                            <th>ကုမ္ပဏီ / တင်သူ</th>
                            <th>တင်သည့်ရက်စွဲ</th>
                            <th>တည်နေရာ</th>
                            <!-- 💡 ADDED: Approval Status Column -->
                            <th>အတည်ပြုချက်</th>
                            <th>Active</th>
                            <th>လုပ်ဆောင်ချက်များ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loop through the jobs list -->
                        <tr th:each="job : ${jobsPage.content}">
                            <td th:text="${job.id}">1</td>
                            <td>
                                <a th:href="@{/jobs/{id}(id=${job.id})}" th:text="${job.title}">Job Title</a>
                            </td>
                            <td>
                                <span th:text="${job.employerUser?.username} ?: 'N/A'">Employer Username</span>
                            </td>
                            <td th:text="${job.postedDate}">2025-09-30</td>
                            <td th:text="${job.location}">Yangon</td>
                            
                            <!-- 💡 ADDED: Display Approval Status -->
                            <td>
                                <span th:if="${job.isApproved()}" class="status-approved">
                                    <i class="fas fa-check-double"></i> အတည်ပြုပြီး
                                </span>
                                <span th:unless="${job.isApproved()}" class="status-pending">
                                    <i class="fas fa-clock"></i> စောင့်ဆိုင်းဆဲ
                                </span>
                            </td>
                            
                            <td>
                                <span th:if="${job.isActive()}" class="status-active">
                                    <i class="fas fa-check-circle"></i> Yes
                                </span>
                                <span th:unless="${job.isActive()}" class="status-inactive">
                                    <i class="fas fa-times-circle"></i> No
                                </span>
                            </td>
                            <td>
                                <!-- Action Buttons -->
                                <div class="btn-group" role="group">
                                    <!-- 💡 ADDED: Approve Button (only if not approved) -->
                                    <a th:if="${!job.isApproved()}" th:href="@{/admin/jobs/approve/{id}(id=${job.id})}" class="btn btn-sm btn-success" title="အတည်ပြုရန်">
                                        <i class="fas fa-thumbs-up"></i> Approve
                                    </a>
                                    
                                    <a th:href="@{/employer/jobs/edit/{id}(id=${job.id})}" class="btn btn-sm btn-warning" title="ပြင်ဆင်ရန်">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a th:href="@{/employer/jobs/delete/{id}(id=${job.id})}" class="btn btn-sm btn-danger delete-btn"
                                       data-bs-toggle="modal"
                                       data-bs-target="#deleteConfirmationModal"
                                       th:data-job-id="${job.id}"
                                       title="ဖျက်ပစ်ရန်">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                    <a th:href="@{/employer/jobs/{id}/applicants(id=${job.id})}" class="btn btn-sm btn-info" title="လျှောက်ထားသူများ">
                                        <i class="fas fa-users"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- No Jobs Found -->
            <div th:unless="${jobs != null and not jobs.isEmpty()}" class="alert alert-info text-center">
                <i class="fas fa-info-circle me-2"></i> လက်ရှိတွင် စီမံခန့်ခွဲရန် Job များ စာရင်း မရှိသေးပါ။
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal (Optional: For better UX) -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="deleteModalLabel">အလုပ်ဖျက်ပစ်ခြင်း အတည်ပြုချက်</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p><strong>သတိပြုရန်:</strong> ဤ Job ကို ဖျက်လိုက်ပါက ပြန်လည်ဖော်ယူနိုင်မည်မဟုတ်ပါ။</p>
            <p>ဆက်လက်ဆောင်ရွက်လိုပါသလား။</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">မဖျက်တော့ပါ</button>
            <a id="confirmDeleteButton" href="#" class="btn btn-danger">အတည်ပြုဖျက်ပစ်မည်</a>
          </div>
        </div>
        </div>
    </div>
    
    <div th:replace="~{fragments/footer :: main-footer}"></div>
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
    <script>
        // JavaScript for handling the Delete Confirmation Modal
        document.addEventListener('DOMContentLoaded', function() {
            var deleteModal = document.getElementById('deleteConfirmationModal');
            if (deleteModal) {
                deleteModal.addEventListener('show.bs.modal', function (event) {
                    // Button that triggered the modal
                    var button = event.relatedTarget;
                    // Extract info from data-job-id attribute
                    var jobId = button.getAttribute('data-job-id');

                    // Update the modal's delete button link
                    var confirmButton = deleteModal.querySelector('#confirmDeleteButton');
                    confirmButton.href = '/employer/jobs/delete/' + jobId;
                });
            }
        });
    </script>
</body>
</html>


